FROM oven/bun:1.3.4-slim
WORKDIR /app

# Copy dependency files first for better layer caching
COPY package.json bun.lock* ./
COPY packages/*/package.json ./packages/*/
COPY apps/api/package.json ./apps/api/

# Install all dependencies (including dev dependencies for development)
RUN bun install

# Copy source code and config files
COPY packages ./packages
COPY apps/api ./apps/api
COPY turbo.json ./

EXPOSE 3001

ENV NODE_ENV=development
ENV PORT=3001

# Use watch mode for hot reloading
CMD ["bun", "run", "--watch", "apps/api/index.ts"]

